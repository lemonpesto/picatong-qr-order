<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>메뉴판</title>
    <link rel="stylesheet" href="/main.css" />
    <script src="https://kit.fontawesome.com/a3ff865f92.js" crossorigin="anonymous"></script>
  </head>
  <body>
    <%- include("nav.ejs") %>
    <!-- 카테고리 목차 -->
    <div class="category-bar">
      <% categories.forEach((cat, i) => { %>
      <button class="category-button" data-target="section-<%= cat.name %>"><%= cat.name %></button>
      <% }) %>
    </div>

    <!-- 메뉴 리스트 -->
    <% categories.forEach((cat, i) => { %>
    <div id="section-<%= cat.name %>" class="menu-section">
      <h3><%= cat.name %></h3>
      <% const filteredMenus = menus.filter(m => m.category === cat.name); filteredMenus.forEach((menu, j) => { %>
      <div class="list-box" data-name="<%= menu.name %>" data-price="<%= menu.price %>" data-menuid="<%= menu._id %>">
        <h4><%= menu.name %></h4>
        <p class="price"><%= menu.price.toLocaleString() %>원</p>
        <p class="description"><%= menu.description || '' %></p>
      </div>

      <% if (j !== filteredMenus.length - 1) { %>
      <div class="menu-divider"></div>
      <% } %> <% }) %>
    </div>

    <% if (i !== categories.length - 1) { %>
    <div class="section-divider"></div>
    <% }}) %>

    <!-- 장바구니 보기 버튼 -->
    <div class="bottom-bar">
      <a href="/cart" id="view-cart" class="bottom-button hidden">장바구니 보기</a>
    </div>

    <!-- 바텀 시트 -->
    <div id="bottom-sheet" class="bottom-sheet hidden">
      <div class="bottom-sheet-content">
        <div class="sheet-header">
          <h4 id="sheet-name">메뉴명</h4>
          <button id="close-sheet">✕</button>
        </div>
        <div class="sheet-subheader">
          <span id="sheet-price">단가</span>
        </div>
        <!-- 수량 조정 -->
        <div class="sheet-qty-row">
          <span class="qty-label">수량</span>
          <div class="qty-control">
            <button id="minus" class="qty-btn"><i class="fa-solid fa-minus fa-2xs"></i></button>
            <span id="qty" class="qty">1</span>
            <button id="plus" class="qty-btn"><i class="fa-solid fa-plus fa-2xs"></i></button>
          </div>
        </div>
        <!-- 장바구니 담기 버튼 -->
        <button id="add-to-cart" class="cart-button">장바구니에 담기</button>
      </div>
    </div>
    <div id="toast" class="toast-msg"></div>
    <div id="overlay" class="overlay hidden"></div>

    <script>
      // smartSticky.js
      window.addEventListener('DOMContentLoaded', () => {
        const bar = document.querySelector('.bottom-bar');
        if (!bar) return;

        const isScrollable = document.body.scrollHeight > window.innerHeight;
        if (!isScrollable) {
          bar.style.position = 'fixed';
        } else {
          bar.style.position = 'sticky';
        }
      });
      function showToast(message) {
        const toast = document.getElementById('toast');
        if (!toast) return;

        toast.textContent = message;
        toast.classList.add('show');

        setTimeout(() => {
          toast.classList.remove('show');
        }, 2000);
      }
    </script>
    <script src="/menu.js"></script>
    <script src="/menu-category.js"></script>
    <script src="/menu-bottom.js"></script>
  </body>
</html>
